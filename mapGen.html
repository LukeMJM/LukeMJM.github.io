<!DOCTYPE html>
<html>
<head>
	<title>MapGen</title>
	<script src="processing.js"></script>
</head>
<body>
	<canvas id="canvas"></canvas>
	<script type="application/javascript">
                
        function sketchProc(processing) {

            // NOTES
            // cell adjacencies - 
            // the cell above a given cell has a id of 1 less than the given cell, below is 1 more
            // the cell to the left of a given cell has an id of 100 less than the given cell, and to the right is 100 more
            
            //               [314][414][514]
            // ie:           [315][415][515]
            //               [316][416][516]

            

       
            // *****************************************************
            //                  GLOBAL VARIABLES
            // *****************************************************

            var cellWidth = 5;
            var cellHeight = 5;
            var cellArray = [];
            var cellsOnX;
            var cellsOnY;
            var windowW;
            var windowH;
            var flag = false;
            var randX = processing.random(0,100).toFixed(0);
            var randY = processing.random(0,100).toFixed(0);
            var targetCell;
            var currentCell;
            var cellID = 0;
            // *******************************************************
            //                       OBJECTS
            // *******************************************************

                // TYPES:
                // 1 - water

            class cell {
                constructor(x, y, row, column, type) {
                    this.id = cellID;
                    this.x = x;
                    this.y = y;
                    this.row = row;
                    this.column = column;
                    this.width = cellWidth;
                    this.height = cellHeight;
                    this.type = type;
                    this.weight = 50;
                }
                drawCell() {
                    var red, green, blue;

                    if (this.type == 1) {
                        red = (this.x + 1) /2;
                        green = 160;
                        blue = 200;
                    }

                    if (this.type == 2) {
                        red = 0;
                        green = 0;
                        blue = 0;
                    }
                    processing.fill(red, green, blue);
                    processing.rect(this.x, this.y, this.width, this.height);

                }
                mutate() {
                    cellArray.forEach(element => {
                        if (element.weight > 60)
                            element.type = 2;
                    });
                }
                designateSeed(){
                    cellArray.forEach(element => {
                        if (element.row == randX && element.column == randY) {
                            element.weight += 10;
                            targetCell = element.id;
                        }
                    });
                }
                spread                                                                                                          
            }

            //const cell1x1 = new cell(0, 0, 0, 0, 2);


            // %%%%%%%%%%%%%%% FUNCTIONAL FUNCTIONS NOT RELATED TO OBJECTS %%%%%%%%%%%%%%%%%%%%

            currentCellInfo = function (cellArray) {
                cellArray.forEach(element => {
                    if ((processing.mouseX >= element.x && processing.mouseX < (element.x + 5)) && (processing.mouseY >= element.y && processing.mouseY < (element.y + 5))) {

                        currentCell = element.id;

                    }
                });
            }
            

            // *******************************************************
            //                       SETUP
            // *******************************************************

            processing.setup = function(){
                processing.frameRate (60);
                processing.size(500,500);
                windowH = processing.height;
                windowW = processing.width;
                cellsOnX = windowW / cellWidth;
                cellsOnY = windowH / cellHeight;
                processing.background(200,200,200);
                processing.noStroke()

                
            }

            // *******************************************************
            //                       GAME LOOP
            // *******************************************************

            processing.draw = function() {

                //processing.background(220,220,220);

                // ******************* CREATING CELL GRID **********************

                if (cellArray.length < 10000) {

                    for (var row=0; row < cellsOnY; row++) {
                        
                        for (var column=0; column < cellsOnX; column++) {

                            var x = row*5;

                            var y = column*5;
                            
                            const cell5x5 = new cell(x, y, row, column, 1);

                            cellArray.push(cell5x5);
                            cellID++;
                            

                        }
                        
                    }
                }

                // manipulate the cells

                cellArray.forEach(element => {

                    // draws every cell object in the cell array
                    element.drawCell(cellArray);

                    // mutates any cells matching the requirements to type 2
                    element.mutate();

                    // designates an origin point to start building terrain from
                    element.designateSeed();

                    if (element.id == 765) {
                        element.type = 2;
                    }
                    

                });

                currentCellInfo(cellArray);
                
                // outputting details of every cell to the console
                if (flag) {

                    var asda = cellArray[1].toString.toString;
                    console.log(asda);

                    for (var o in cellArray) {
                        console.log ("cell " + o);
                        
                        for (var k in cellArray[o]) {
                            console.log(" " + cellArray[o][k]);
                        }
                    }



                    flag = true;
                }


            // *****************************************************
            //                     DEBUGGING
            // *****************************************************
                
                processing.fill(255,255,255);
                processing.text("window height: " + windowH, 350,20);
                processing.text("window width: " + windowW, 350,30);
                processing.text("X Cells: " + cellsOnX, 350,40);
                processing.text("Y Cells: " + cellsOnY, 350,50);
                processing.text("X rand: " + randX, 350,60);
                processing.text("Y rand: " + randY, 350,70);
                processing.text("seed cell ID: " + targetCell, 350,80);
                processing.text("current cell ID: " + currentCell, 350,90);


                

            }

            
        }

        var canvas = document.getElementById("canvas");
        // attaching the sketchProc function to the canvas
        var processingInstance = new Processing(canvas, sketchProc);
        
	</script>
</body>
</html>
